---
document_id: MEMINIT-SPEC-005
type: SPEC
title: Scan Plan Format
status: Draft
version: "1.0"
last_updated: 2026-03-01
owner: Product Team
docops_version: "2.0"
area: Adoption
description: "Normative JSON format for brownfield scan plans and plan-driven fixes."
keywords:
  - scan
  - plan
  - fix
  - migration
  - brownfield
related_ids:
  - MEMINIT-PRD-004
  - MEMINIT-PLAN-003
  - MEMINIT-STRAT-001
---

<!-- MEMINIT_METADATA_BLOCK -->

> **Document ID:** MEMINIT-SPEC-005
> **Owner:** Product Team
> **Status:** Draft
> **Version:** 1.0
> **Last Updated:** 2026-03-01
> **Type:** SPEC
> **Area:** Adoption

# SPEC: Scan Plan Format

## 1. Purpose

This document defines the JSON format for deterministic migration plans generated by `meminit scan --plan` and consumed by `meminit fix --plan`.

Plain English: This spec describes the exact structure of the plan file that tells Meminit how to migrate a brownfield repo.

## 2. Content Envelope

The migration plan is a JSON document wrapped in the canonical Meminit JSON envelope:

- `output_schema_version`: "2.0"
- `success`: boolean
- `command`: "scan"
- `run_id`: string
- `root`: string (repository root)
- `data.plan`: the core MigrationPlan payload

## 3. MigrationPlan Model (`data.plan`)

- `plan_version` (string): Standard version (e.g., "1.0").
- `generated_at` (string): UTC ISO-8601 timestamp.
- `config_fingerprint` (string): A hash of the active configuration to detect context drift.
- `actions` (array of `PlanAction`): A list of actions to apply. MUST be sorted deterministically (by `source_path` then action type priority).

## 4. PlanAction Model

Each action in `actions` MUST be an object with the following fields:

- `id` (string): A stable identifier based on canonicalized action fields.
- `action` (string): A closed enum value (see below).
- `source_path` (string): The path to the file indicating the source of the change, relative to root.
- `target_path` (string): The path where the file will reside, relative to root.
- `confidence` (float): A heuristically-generated confidence score (0.0 to 1.0).
- `rationale` (array of strings): Explanations for why this action was generated.
- `preconditions` (object): Required state before applying the action.
  - `source_sha256` (string): The hash of the source file content at scan time.
- `metadata_patch` (object, optional): Frontmatter keys and values to insert or update.
- `safety` (object):
  - `destructive` (boolean): MUST be false.
  - `overwrites` (boolean): True only if explicitly permitting an overwrite as part of an intended rename sequence.

## 5. Action Enum

- `insert_metadata_block`: Inserts or modifies a YAML frontmatter block in a Markdown file. Despite the name, this **patches the YAML frontmatter directly** (via `python-frontmatter`) and does **not** insert the literal HTML `<!-- MEMINIT_METADATA_BLOCK -->` comment.
- `update_metadata`: Updates the frontmatter keys inside the YAML metadata block.
- `move_file`: Moves a file from `source_path` to `target_path` (e.g., for type-directory compliance).
- `rename_file`: Renames a file at the same directory level (e.g., converting spacing/casing).

## 6. Validation Rules for `meminit fix --plan`

1. **Safe-Path:** All paths MUST resolve within `root`. Symlink escapes and traversals (e.g., `../`) MUST be rejected.
2. **Non-Destructive:** No files may be deleted.
3. **Drift Detection:** If `preconditions.source_sha256` is defined, the source file's current hash MUST match before applying.
4. **Collision Policy:** Overwriting existing files during a move/rename is FORBIDDEN unless explicitly permitted by `safety.overwrites`.

## 7. Deterministic Ordering

1. `actions` MUST be sorted by `source_path` (ascending), then by `action` (priority order).
2. `id` MUST be stable and deterministic for a given input repository.

Plain English: The same repo should always produce the exact same plan.
